<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.batch.lesson.mapper.LessonOpenMapper">
    <select id="findOpenLesson" resultType="com.example.batch.lesson.domain.Lesson">
        SELECT id,
               lesson_name,
               lesson_time,
               start_dt,
               open_dt,
               complete_open_dt
          FROM lesson
         WHERE open_dt BETWEEN #{startDt} AND #{endDt}
           AND complete_open_dt IS NULL
         LIMIT #{_pagesize}
    </select>

    <update id="updateLesson" parameterType="com.example.batch.lesson.domain.Lesson">
        UPDATE lesson
           SET complete_open_dt = #{completeOpenDt}
         WHERE id = #{id}
    </update>

    <update id="updateBulkLesson" parameterType="java.util.List">
        UPDATE lesson
           SET complete_open_dt = now()
         WHERE id IN
        <foreach collection="lesson" item="item" open="(" close=")" separator=",">
            #{item.id}
        </foreach>
    </update>

    <select id="findOpenLessonByTest" resultType="com.example.batch.lesson.domain.Lesson">
        SELECT id,
               lesson_name,
               lesson_time,
               start_dt,
               open_dt,
               complete_open_dt
          FROM lesson
         WHERE open_dt BETWEEN #{startDt} AND #{endDt}
           AND complete_open_dt IS NULL
    </select>
</mapper>